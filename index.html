<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Å†„ÅÑ„Å®„Åè„Çì „Å®„Åë„ÅÑ „Å†„ÅÑ„Åô„ÅçÔºÅ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #87CEEB 0%, #E0F6FF 100%);
            font-family: 'Hiragino Maru Gothic ProN', 'HGMaruGothicMPRO', sans-serif;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5em;
            color: #FF69B4;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }

        .category-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .category-btn {
            padding: 12px 20px;
            font-size: 1.1em;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            background: white;
            color: #333;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .category-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .category-btn.active {
            background: #FF69B4;
            color: white;
            transform: scale(1.1);
        }

        .main-content {
            background: white;
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .image-container {
            width: 100%;
            height: 400px;
            background: #f0f0f0;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }

        .image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .image-info {
            text-align: center;
            margin-bottom: 20px;
        }

        .image-title {
            font-size: 1.8em;
            color: #FF69B4;
            margin-bottom: 10px;
        }

        .image-desc {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 10px;
        }

        .counter {
            font-size: 0.9em;
            color: #999;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            flex: 1;
            padding: 15px;
            font-size: 1.2em;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        #btnNext {
            background: #4169E1;
            color: white;
        }

        #btnNext:hover {
            background: #315AC1;
            transform: scale(1.05);
        }

        #btnSave {
            background: #FF69B4;
            color: white;
        }

        #btnSave:hover {
            background: #FF1493;
            transform: scale(1.05);
        }

        .favorites-section {
            background: #FFF8DC;
            border-radius: 20px;
            padding: 20px;
            margin-top: 30px;
        }

        .favorites-title {
            font-size: 1.5em;
            color: #FF69B4;
            margin-bottom: 15px;
            text-align: center;
        }

        .favorites-count {
            text-align: center;
            font-size: 1.1em;
            color: #666;
            margin-bottom: 15px;
        }

        #favCount {
            font-weight: bold;
            color: #FF69B4;
        }

        .favorites-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }

        .favorite-item {
            position: relative;
            cursor: pointer;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .favorite-item:hover {
            transform: scale(1.05);
        }

        .favorite-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }

        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-btn:hover {
            background: rgba(255, 0, 0, 1);
        }

        @media (max-width: 600px) {
            .title {
                font-size: 1.8em;
            }

            .image-container {
                height: 300px;
            }

            .category-btn {
                padding: 10px 15px;
                font-size: 0.9em;
            }

            .btn {
                padding: 12px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">‚è∞ „Å†„ÅÑ„Å®„Åè„Çì „Å®„Åë„ÅÑ „Å†„ÅÑ„Åô„ÅçÔºÅ</div>
            <div class="subtitle">„ÅÑ„Çç„Çì„Å™ „Å®„Åë„ÅÑ „Çí „Åø„Å¶„Åø„Çà„ÅÜÔºÅ</div>
        </div>

        <div class="category-buttons">
            <button class="category-btn" data-category="all">üü¢ „Åú„Çì„Å∂</button>
            <button class="category-btn" data-category="Êó•Êú¨">üü° „Å´„Åª„Çì</button>
            <button class="category-btn" data-category="„Åµ„Çã„ÅÑ">üî¥ „Åµ„Çã„ÅÑ</button>
            <button class="category-btn" data-category="„ÅÇ„Åü„Çâ„Åó„ÅÑ">üîµ „ÅÇ„Åü„Çâ„Åó„ÅÑ</button>
            <button class="category-btn" data-category="„Åã„ÅÑ„Åå„ÅÑ">‚ö™ „Åã„ÅÑ„Åå„ÅÑ</button>
        </div>

        <div class="main-content">
            <div class="image-container" id="imgContainer">
                <div style="text-align: center; color: #999;">„Çà„Åø„Åì„Åø„Å°„ÇÖ„ÅÜ...</div>
            </div>

            <div class="image-info">
                <div class="image-title" id="imgTitle">-</div>
                <div class="image-desc" id="imgDesc">-</div>
                <div class="counter" id="counter">-</div>
            </div>

            <div class="button-group">
                <button class="btn" id="btnNext">„Å§„Åé„ÅÆ „Å®„Åë„ÅÑ ‚ñ∂</button>
                <button class="btn" id="btnSave">‚ù§Ô∏è „Åª„Åû„Çì</button>
            </div>
        </div>

        <div class="favorites-section">
            <div class="favorites-title">‚≠ê „Åä„Åç„Å´„ÅÑ„Çä</div>
            <div class="favorites-count">
                <span id="favCount">0</span>„Åæ„ÅÑ
            </div>
            <div class="favorites-list" id="favList"></div>
        </div>
    </div>

    <script>
        let currentCategory = 'all';
        let currentIndex = 0;
        let filteredData = [];
        let favorites = JSON.parse(localStorage.getItem('clock_favorites') || '[]');
        let allClockData = [];

        // Fetch clock data from JSON
        async function loadClockData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/miyajino5/daitokun-clock-daisuki/master/clock_data.json');
                if (response.ok) {
                    allClockData = await response.json();
                } else {
                    // Fallback: use inline data
                    allClockData = getInlineClockData();
                }
            } catch (e) {
                console.log('Using inline clock data');
                allClockData = getInlineClockData();
            }
            filterCategory('all');
            updateFavoritesList();
        }

        function getInlineClockData() {
            // This will be populated by the data from verified_clock_urls.json
            return [];
        }

        const imgContainer = document.getElementById('imgContainer');
        const imgTitle = document.getElementById('imgTitle');
        const imgDesc = document.getElementById('imgDesc');
        const counter = document.getElementById('counter');
        const btnNext = document.getElementById('btnNext');
        const btnSave = document.getElementById('btnSave');
        const favCount = document.getElementById('favCount');
        const favList = document.getElementById('favList');
        const categoryBtns = document.querySelectorAll('.category-btn');

        function updateDisplay() {
            if (filteredData.length === 0) {
                imgContainer.innerHTML = '<div style="text-align: center; color: #999;">„Å®„Åë„ÅÑ„Åå „ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }

            const item = filteredData[currentIndex];
            imgContainer.innerHTML = `<img src="${item.url}" alt="${item.title}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 font-size=%2224%22 fill=%22%23999%22%3E„Åå„Åû„ÅÜ„Åå „Çà„ÇÅ„Åæ„Åõ„Çì%3C/text%3E%3C/svg%3E'">`;
            imgTitle.textContent = item.title;
            imgDesc.textContent = item.desc;
            counter.textContent = `${currentIndex + 1} / ${filteredData.length}`;

            const isFav = favorites.some(f => f.url === item.url);
            btnSave.textContent = isFav ? '‚ù§Ô∏è „Åª„Åû„Çì„Åö„Åø' : '‚ù§Ô∏è „Åª„Åû„Çì';
            btnSave.style.opacity = isFav ? '0.7' : '1';
        }

        function filterCategory(category) {
            currentCategory = category;
            if (category === 'all') {
                filteredData = [...allClockData];
            } else {
                filteredData = allClockData.filter(item => item.category === category);
            }
            currentIndex = 0;
            updateDisplay();

            categoryBtns.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.category === category);
            });
        }

        function nextImage() {
            if (filteredData.length === 0) return;
            currentIndex = (currentIndex + 1) % filteredData.length;
            updateDisplay();
        }

        function saveFavorite() {
            if (filteredData.length === 0) return;
            const item = filteredData[currentIndex];
            const exists = favorites.some(f => f.url === item.url);

            if (!exists) {
                favorites.push(item);
                localStorage.setItem('clock_favorites', JSON.stringify(favorites));
                updateFavoritesList();
                updateDisplay();
            }
        }

        function removeFavorite(url) {
            favorites = favorites.filter(f => f.url !== url);
            localStorage.setItem('clock_favorites', JSON.stringify(favorites));
            updateFavoritesList();
            updateDisplay();
        }

        function updateFavoritesList() {
            favCount.textContent = `${favorites.length}`;
            favList.innerHTML = '';
            favorites.forEach(item => {
                const div = document.createElement('div');
                div.className = 'favorite-item';
                div.innerHTML = `
                    <img src="${item.url}" alt="${item.title}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22100%22 height=%22100%22/%3E%3C/svg%3E'">
                    <button class="remove-btn" onclick="event.stopPropagation(); removeFavorite('${item.url.replace(/'/g, "\\'")}')">√ó</button>
                `;
                div.onclick = () => {
                    const index = filteredData.findIndex(f => f.url === item.url);
                    if (index !== -1) {
                        currentIndex = index;
                        updateDisplay();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                };
                favList.appendChild(div);
            });
        }

        btnNext.onclick = nextImage;
        btnSave.onclick = saveFavorite;
        imgContainer.onclick = nextImage;

        categoryBtns.forEach(btn => {
            btn.onclick = () => filterCategory(btn.dataset.category);
        });

        // Load data on page load
        window.addEventListener('DOMContentLoaded', loadClockData);
    </script>
</body>
</html>
